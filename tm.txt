Befizetések

Amikor befizetés érkezik, akkor a rendszer törli az adott felhasználó financial_history -ját
A Deposits táblába új sor íródik.


Felhasználók befizetési előzményei
  - a Users.financial_history generálódik, ha alaból null ÉS  ( a user rámegy a "Befizetéseim" menüpontra, VAGY amikor az admin nézi egy konkrét user előzményét (egy adott usernél) )
  - a Users.financial_history törlődik,
    - újabb befizetés érkezik  (egy adott usernél)
    - befizetés módosult
    - befizetés törlődött
    - ha a foreseen corn job lefutot (az összes usernél) akkor + 1 query, ami az összes user-nél null-ra állítja a financial_history értékét

A financial_history egy serialized medium blob cella


befizetéskor a deposits táblába írjuk a befizetéssel kapcsolatos információkat
hogy melyik lakásnak mennyit kellett eddig közös költségekre fizetni, azt a foreseen_charges táblából kérdezhető le
   ez minden hónap végén cron job segítségével töltődik fel



a lakások egyenlegeinek lekérdezése
SELECT (SUM(deposits.money)-SUM(commonCharges.commonCharge)) as balance FROM `deposits` 
LEFT JOIN commonCharges ON deposits.flatsId = commonCharges.flatsId
WHERE deposits.flatsId = 45
GROUP BY commonCharges.flatsId, deposits.flatId

SELECT SUM(money) as deposit FROM deposits WHERE flatsId = 45;
SELECT SUM(commonCharge) as charge FROM commonCharges WHERE flatsId = 45;

SELECT (SUM(deposits.money)-SUM(commonCharges.commonCharge)) as balance,
SUM(deposits.money) as money,
SUM(commonCharges.commonCharge) as ccharge
FROM `deposits` 
JOIN commonCharges ON deposits.flatsId = commonCharges.flatsId
WHERE deposits.flatsId = 45